CREATE DATABASE CONCESSIONARIA

GO

USE CONCESSIONARIA

GO

CREATE TABLE CLIENTE
(
	NUM_CPF CHAR(11) NOT NULL PRIMARY KEY,
	NOM_CLIENTE VARCHAR (100) NOT NULL,
	DES_ENDERECO VARCHAR (100) NOT NULL,
	DTA_NASCIMENTO DATE NOT NULL,
	ARQ_FOTO VARCHAR(50),
	NUM_RG VARCHAR(10) UNIQUE
);

GO

CREATE TABLE CARGO
(
	ID_CARGO INT IDENTITY(1,1) NOT NULL PRIMARY  KEY,
	NOM_CARGO VARCHAR(50) NOT NULL UNIQUE
);

GO

CREATE TABLE FUNCIONARIO
(
	NUM_CPF CHAR(11) NOT NULL PRIMARY KEY,
	NOM_FUNCIONARIO VARCHAR (100) NOT NULL,
	DES_ENDERECO VARCHAR (100) NOT NULL,
	DTA_NASCIMENTO DATE NOT NULL,
	ARQ_FOTO VARCHAR(50),
	NUM_RG VARCHAR(10) UNIQUE,
	DTA_CONTRATACAO DATE NOT NULL,
	ID_CARGO INT NOT NULL,
	NUM_NIVEL TINYINT NOT NULL,

	CONSTRAINT FK_CARGO_FUNC FOREIGN KEY (ID_CARGO)
	REFERENCES CARGO (ID_CARGO)
);

GO

CREATE TABLE TIPO_AUTOMOVEL
(
	ID_TPAUTO INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
	NOM_TPAUTO VARCHAR (50) UNIQUE NOT NULL
);

GO

CREATE TABLE MARCA
(
	ID_MARCA INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
	NOM_MARCA VARCHAR (50) UNIQUE NOT NULL
);

GO

CREATE TABLE COR
(
	ID_COR INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
	NOM_COR VARCHAR (50) UNIQUE NOT NULL
);

GO

CREATE TABLE MODELO
(
	ID_MODELO INT IDENTITY(1,1) NOT NULL,
	NOM_MODELO VARCHAR(50) UNIQUE NOT NULL,
	ID_MARCA INT NOT NULL,
	NUM_ANO INT NOT NULL,
	PRIMARY KEY(ID_MARCA,ID_MODELO,NUM_ANO),
	CONSTRAINT FK_MODELO_MARCA FOREIGN KEY (ID_MARCA)
	REFERENCES MARCA (ID_MARCA)
);

GO

CREATE TABLE SEGURADORA
(
	ID_SEGURADORA INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
	NOM_SEGURADORA VARCHAR (50) UNIQUE NOT NULL,
	DES_ENDERECO VARCHAR(50) NOT NULL,
	NUM_TELEFONE VARCHAR(20) NOT NULL
);

GO

CREATE TABLE FUNCIONARIO_SALARIO
(
	NUM_CPF_FUNCIONARIO CHAR(11) NOT NULL,
	VAL_SALARIO FLOAT NOT NULL,
	DTA_INICIO DATE NOT NULL,
	PRIMARY KEY (NUM_CPF_FUNCIONARIO,DTA_INICIO),
	CONSTRAINT FK_FUNC_SALARIO FOREIGN KEY (NUM_CPF_FUNCIONARIO)
	REFERENCES FUNCIONARIO (NUM_CPF)
);

GO

CREATE TABLE AUTOMOVEL
(
	DES_CHASSI CHAR(17) NOT NULL PRIMARY KEY,
	VAL_PRECO FLOAT NOT NULL,
	ID_TPAUTO INT NOT NULL,
	ID_MODELO INT NOT NULL,
	ID_COR INT NOT NULL,
	NUM_ANO INT NOT NULL,
	ID_MARCA INT NOT NULL,
	ARQ_FOTO VARCHAR(50),
	CONSTRAINT FK_TPAUTO_AUTOMOVEL FOREIGN KEY (ID_TPAUTO)
	REFERENCES TIPO_AUTOMOVEL (ID_TPAUTO),
	CONSTRAINT FK_MODELO_AUTOMOVEL FOREIGN KEY (ID_MODELO, ID_MARCA, NUM_ANO)
	REFERENCES MODELO, 
	CONSTRAINT FK_COR_AUTOMOVEL FOREIGN KEY (ID_COR)
	REFERENCES COR (ID_COR),
);

GO

CREATE TABLE FUNCIONARIO_VENDA_AUTO
(
	NUM_CPF_FUNCIONARIO CHAR(11) NOT NULL,
	DES_CHASSI CHAR(17) NOT NULL,
	DTA_VENDA DATE NOT NULL,
	PRIMARY KEY (NUM_CPF_FUNCIONARIO,DES_CHASSI,DTA_VENDA),
	CONSTRAINT FK_FUNC_VENDA FOREIGN KEY (NUM_CPF_FUNCIONARIO)
	REFERENCES FUNCIONARIO (NUM_CPF),
	CONSTRAINT FK_AUTOMOVEL_VENDA FOREIGN KEY (DES_CHASSI)
	REFERENCES AUTOMOVEL (DES_CHASSI)
);

GO

CREATE TABLE REVISAO
(
	NUM_CPF_FUNCIONARIO CHAR(11) NOT NULL,
	DES_CHASSI CHAR(17) NOT NULL,
	DTA_REVISAO DATE NOT NULL,
	B_ACEITE BIT NOT NULL,
	DES_PLACA VARCHAR(10),
	VAL_PRECO FLOAT NOT NULL,
	PRIMARY KEY (NUM_CPF_FUNCIONARIO,DES_CHASSI, DTA_REVISAO),
	CONSTRAINT FK_FUNC_REVISAO FOREIGN KEY (NUM_CPF_FUNCIONARIO)
	REFERENCES FUNCIONARIO (NUM_CPF),
	CONSTRAINT FK_AUTOMOVEL_REVISAO FOREIGN KEY (DES_CHASSI)
	REFERENCES AUTOMOVEL (DES_CHASSI)
);

GO

CREATE TABLE CLIENTE_AUTOMOVEL
(
	DES_CHASSI CHAR(17) NOT NULL,
	NUM_CPF_CLIENTE CHAR(11) NOT NULL,
	DES_PLACA VARCHAR(10) UNIQUE,
	DTA_INICIO DATE NOT NULL,
	PRIMARY KEY (DES_CHASSI,NUM_CPF_CLIENTE, DTA_INICIO),
	CONSTRAINT FK_AUTOMOVEL_CLIENTE FOREIGN KEY (DES_CHASSI)
	REFERENCES AUTOMOVEL (DES_CHASSI),
	CONSTRAINT FK_CLIENTE_AUTO FOREIGN KEY (NUM_CPF_CLIENTE)
	REFERENCES CLIENTE (NUM_CPF)
);

GO

CREATE TABLE SEGURO
(
	ID_SEGURO INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
	NOM_SEGURO VARCHAR(100) NOT NULL,
	VAL_PRECO FLOAT NOT NULL,
	ID_SEGURADORA INT NOT NULL,
	CONSTRAINT FK_SEGURADORA_SEGURO FOREIGN KEY (ID_SEGURADORA)
	REFERENCES SEGURADORA (ID_SEGURADORA)
);

GO

CREATE TABLE SEGURO_AUTOMOVEL
(
	NUM_CPF_FUNCIONARIO CHAR(11) NOT NULL,
	ID_SEGURO INT NOT NULL,
	DES_CHASSI CHAR(17) NOT NULL,
	DTA_CONTRATO DATE NOT NULL,
	PRIMARY KEY (ID_SEGURO, DES_CHASSI, DTA_CONTRATO),
	CONSTRAINT FK_SEGURO_FUNC FOREIGN KEY (NUM_CPF_FUNCIONARIO)
	REFERENCES FUNCIONARIO (NUM_CPF),
	CONSTRAINT FK_SEGURO_AUTO FOREIGN KEY (ID_SEGURO)
	REFERENCES SEGURO,
	CONSTRAINT FK_SEGURO_AUTO_CHASSI FOREIGN KEY (DES_CHASSI)
	REFERENCES AUTOMOVEL
);